# SGCAST

SGCAST is a simple and efficient framework for identifying spatial domains by encoding spatial location and gene expression information to latent embeddings. SGCAST  can not only conduct accurate identification of spatial domains but also finish further extraction of
spatially expressed genes, which are critical for understanding tissue
organization and biological functions. SGCAST transforms information on gene expression and the position of spots into two adjacency matrices and further adopts a symmetric graph convolutional auto-encoder to integrate them.


## Tutorials

+ A data preprocessing tutorial using CITE-seq and ASAP-seq PBMC data from control condition generated by Mimitou et al. 2020 (GSE156478) is demonstrated here: [link](https://github.com/sydneybiox/scJoint/blob/main/tutorial/CITE-seq%20and%20ASAP-seq%20integration%20using%20scJoint.ipynb)
+ Tutorial for clustering: 
    + DLPFC dataset [link](https://github.com/cuhklinlab/SGCAST/blob/main/SGCAST/DLPFC_clustering.ipynb)
    + high-resolution data [link](https://github.com/cuhklinlab/SGCAST/blob/main/SGCAST/high-res_clustering.ipynb)


## Installation:
 
SGCAST is implemented in the pytorch framework. Please run SGCAST on CUDA. The following packages are required to be able to run everything in this repository (included are the versions we used):

```bash
anndata==0.8.0 
bokeh==2.4.2
h5py==3.6.0
imageio==2.9.0   
matplotlib==3.5.1 
numpy==1.21.5
pandas==1.4.2
python-igraph==0.9.6
python-louvain==0.15 
scanpy==1.9.1 
scikit-image==0.19.2
scikit-learn==1.1.3
scipy==1.7.3
seaborn==0.11.2
pytorch==1.12.1
torch-geometric==1.7.0 
torchvision==0.13.1
tqdm==4.64.0
umap-learn==0.5.3 
```
### the location of R (used for the mclust clustering)

(**Recommended**) Using python virutal environment with conda（<https://anaconda.org/>）
```shell
conda create -n SGCAST python=3.9 pip
conda activate SGCAST
pip install -r requirements.txt
```



## Running SGCAST

Edit `config.py` according to the data input (See Arguments section for more details).

In terminal, run

```
python main.py
```

The output will be saved in `./output` folder.


## Arguments

The script `config.py` indicate the arguments for scJoint, which needs to be modified according to the data.


### Training config

+ `use_cuda`: Whether GPU is used
+ `threads`: Number of threads used (set as 1 by default)

+ `batch_size`: Batch size (set as 256 by default)
+ `lr_stage1`: Learning rate for stage 1
+ `lr_stage3`: Learning rate for stage 3
+ `lr_decay_epoch`: Number of epoch learning rate decay
+ `epochs_stage1`: Number of epochs for stage 1
+ `epochs_stage3`: Number of epochs for stage 3
+ `p`: The fraction of data pairs expected to have high cosine similarity scores (set as 0.8 by default)
+ `embedding_size`: Number of nodes in the embedding (hidden) layer (set as 64 by default)
+ `momentum`: Momentum for SGD (set as 0.9 by default)
+ `center_weight`: The weight for center loss (set as 1 by default)
+ `with_crossentorpy`: `True` indicates well differentiated cell type mode, `False` indicates to run trajectory mode of scJoint.
+ `seed`: seed to be used (set as none by default)

The configuration we used in our paper can be found in [link](https://github.com/sydneybiox/scJoint/blob/main/tutorial/config_notes.ipynb).



## Reference
